{% extends 'student_base_anyone.html' %}
{% load static %}
{% block title %}{{ object.event_name }}{% endblock %}
{% block css %}<link href="{% static 'css/student_detail.css' %}" rel="stylesheet"/>{% endblock %}
{% block contents %}

<!--ä¸€è¦§ç”»é¢ã¸æˆ»ã‚‹ãƒªãƒ³ã‚¯-->
<a href="{% url 'studentapp:eventlist' %}" id="Link-Back">
    ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ã¸
</a>

    <!--ã‚¤ãƒ™ãƒ³ãƒˆåã‚’è¡¨ç¤º-->
    <div>
        <p class="detail-name">{{ object.event_name }}</p>
    </div>
    
    <div class="carouselRange">
        <!--ã‚«ãƒ«ãƒ¼ã‚»ãƒ«-->
        <div id="carouselClubDetail" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
                <!--ãƒšãƒ¼ã‚¸ã‚’é–‹ã„ã¦1æšç›®ã«è¡¨ç¤ºã™ã‚‹ç”»åƒ-->
                <div class="carousel-item active">
                    <img src="{{ object.image1.url }}" class="carouselImg" alt="å†™çœŸ1">
                </div>
                <!--ã‚‚ã—2æšç›®ãŒã‚ã‚‹å ´åˆã€ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹-->
                {% if object.image2 %}
                <div class="carousel-item">
                    <img src="{{ object.image2.url }}" class="carouselImg" alt="å†™çœŸ2">
                </div>
                {% endif %}
                <!--ã‚‚ã—3æšç›®ãŒã‚ã‚‹å ´åˆã€ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹-->
                {% if object.image3 %}
                <div class="carousel-item">
                    <img src="{{ object.image3.url }}" class="carouselImg" alt="å†™çœŸ3">
                </div>
                {% endif %}
                <!--ã‚‚ã—4æšç›®ãŒã‚ã‚‹å ´åˆã€ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹-->
                {% if object.image4 %}
                <div class="carousel-item">
                    <img src="{{ object.image4.url }}" class="carouselImg" alt="å†™çœŸ4">
                </div>
                {% endif %}
                <!--ã‚‚ã—5æšç›®ãŒã‚ã‚‹å ´åˆã€ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹-->
                {% if object.image5 %}
                <div class="carousel-item">
                    <img src="{{ object.image5.url }}" class="carouselImg" alt="å†™çœŸ5">
                </div>
                {% endif %}
            </div>

            <!--å·¦å´(å‰ã®ç”»åƒã¸æˆ»ã‚‹)ã‚«ãƒ«ãƒ¼ã‚»ãƒ«ãƒœã‚¿ãƒ³-->
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselClubDetail" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
            </button>
            <!--å³å´(æ¬¡ã®ç”»åƒã¸é€²ã‚€)ã‚«ãƒ«ãƒ¼ã‚»ãƒ«ãƒœã‚¿ãƒ³-->
            <button class="carousel-control-next" type="button" data-bs-target="#carouselClubDetail" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
            </button>
        </div>
    </div>

    <div class="detailitem">
        <!--ã‚¸ãƒ£ãƒ³ãƒ«ã‚’è¡¨ç¤ºã™ã‚‹-->
        ã‚¸ãƒ£ãƒ³ãƒ« : {{ object.get_category_display }}

        <div id="freeschoolname">ãƒ•ãƒªãƒ¼ã‚¹ã‚¯ãƒ¼ãƒ«å:
        <a href="{% url 'studentapp:freeschoolinfo' object.user.freeschool.pk %}">
            {{ object.user.freeschool.freeschool_name }}
        </a></div>
    
        <!--ä»£è¡¨è€…ã‚’è¡¨ç¤ºã™ã‚‹-->
        <p>ä»£è¡¨è€… : {{ object.REP }}</p>
    
        <!--é›»è©±ç•ªå·ã‚’è¡¨ç¤ºã™ã‚‹-->
        <p>TEL : {{ object.phone_number }}</p>
        <hr>
        <!--æ—¥æ™‚ã‚’è¡¨ç¤ºã™ã‚‹-->
        <p>æ´»å‹•æ—¥æ™‚ : {{ object.date }}</p>
        
        <!--æ´»å‹•å ´æ‰€ã‚’è¡¨ç¤ºã™ã‚‹-->
        <p>æ´»å‹•å ´æ‰€ : {{ object.place }}</p>
    
        <!--å‚åŠ è²»ã‚’è¡¨ç¤ºã™ã‚‹-->
        <p>å‚åŠ è²» : {{ object.fee }}å††</p>
    </div>
    
    <!--ç´¹ä»‹æ–‡ãƒ»æœ¬æ–‡ã‚’è¡¨ç¤ºã™ã‚‹-->
    <h2 id="detaillabel">ã‚¤ãƒ™ãƒ³ãƒˆã®ç´¹ä»‹æ–‡</h2>
    <p class="detailText">{{ object.detail_text|linebreaksbr }}</p>
    
    <!--ä½œæˆæ—¥æ™‚ã‚’è¡¨ç¤ºã™ã‚‹-->
    <p class="detailCreated">{{ object.created_at }}</p>
    
<div class="detail-SNS">
    <!--SNSã®ãƒªãƒ³ã‚¯ã‚’è¡¨ç¤ºã™ã‚‹-->
    <p>
        å…¬å¼SNS
        <a href="{{object.sns_link}}" style="text-decoration:none;"
        id="Link-SNS">
            {{ object.sns_name}}
        </a>
    </p>
</div>

<div class="detail-GR">
    <!--ã„ã„ã­ãƒœã‚¿ãƒ³é–¢é€£ã®å‡¦ç†ã€ãƒ­ã‚°ã‚¤ãƒ³ã•ã‚Œã¦ã„ãªã‘ã‚Œã°ã„ã„ã­ãƒœã‚¿ãƒ³ã¯è¡¨ç¤ºã—ãªã„-->
    {% if user.is_authenticated %}
        <!--ã„ã„ã­ãƒœã‚¿ãƒ³ã®è¡¨ç¤º-->
        <div id="likefield">
        ã„ã„ã­ï¼š
        <button id="likebutton">
        {% if user_has_liked %}
        <!--ã‚¤ã‚¤ãƒã—ã¦ã„ã‚‹å ´åˆ-->
            ğŸ’—
        <!--ã‚¤ã‚¤ãƒã—ã¦ã„ãªã„å ´åˆ-->
        {% else %}
            â™¥
        {% endif %}
        </button>
        </div>

        <script>
            //ã„ã„ã­ãƒœã‚¿ãƒ³ã‚’æŒ‡å®š
            buttonElm=document.getElementById("likebutton");
            
            buttonElm.addEventListener('click',async function(event) {
                event.preventDefault();
                //ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡ä¸­ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹
                buttonElm.disabled=true;
                try {
                    const response=await fetch("{% url 'studentapp:eventlike' pk=object.id %}",{
                        method:'GET',
                        headers:{
                            'X-CSRFToken':'{{ csrf_token }}'
                        }
                    });
            
                    if(!response.ok){
                        throw new Error('é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }
            
                    const data=await response.json();
            
                    if(data.liked) {
                        buttonElm.textContent = "ğŸ’—";
                    }else{
                        buttonElm.textContent = "â™¥";
                    }
                }catch(error) {
                    console.error('ã„ã„ã­ãŒæ­£å¸¸ã«ã§ãã¾ã›ã‚“ã§ã—ãŸ:', error);
                    // ã‚¨ãƒ©ãƒ¼å‡¦ç†ï¼ˆä¾‹ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºï¼‰
                }finally{
                    buttonElm.disabled=false;
                }
            });
        </script>
    {% endif %}
    <br>
    <!--å‚åŠ ç”³ã—è¾¼ã¿ãƒªãƒ³ã‚¯-->
    <!--ãƒ­ã‚°ã‚¤ãƒ³ã•ã‚Œã¦ã„ã‚‹å ´åˆ-->
    {% if user.is_authenticated %}
        <!--åˆ©ç”¨è€…ãŒä¸ç™»æ ¡ç”Ÿå¾’ã®å ´åˆã®ã¿è¡¨ç¤º-->
        {% if user.user_type == 'student' %}
        <a href="{% url 'studentapp:eventrequest' event_id=object.pk %}" id="request-link">å‚åŠ ç”³ã—è¾¼ã¿</a>
        {% endif %}
    {% else %}
        <a data-bs-toggle="modal" data-bs-target="#exampleModal" 
        id="request-link" href="#">
            å‚åŠ ç”³ã—è¾¼ã¿
        </a>
        <!--ãƒ¢ãƒ¼ãƒ€ãƒ«-->
        <div class="modal fade" id="exampleModal" tabindex="-1" 
        aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <!--å³ä¸Šã®Ã—ãƒœã‚¿ãƒ³-->
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <!--ãƒ¢ãƒ¼ãƒ€ãƒ«æœ¬æ–‡-->
                    <div class="modal-body">
                        ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚
                    </div>
                    <div class="modal-footer">
                        <!--ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³-->
                        <button type="button" class="btn btn-outline-secondary" 
                        data-bs-dismiss="modal">
                            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                        </button>
                        <!--ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ãƒœã‚¿ãƒ³-->
                        <a class="btn btn-outline-danger" href="{% url 'accounts:login' %}?next={{ request.path }}" role="button">
                            ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹
                        </a>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}