{% load static %}
{% block title %}{{ record.title }}{% endblock %}
{% block contents %}
    <h1>{{ object.id }}</h1>
    <a>{{ object.title }}</a>
    <img src="{{ object.image1.url }}">
    <!--ç”»åƒ2~5ã¯ã‚ã‚Œã°è¡¨ç¤º-->
    {% if object.image2 %}
        <p><img src="{{ object.image2.url }}"></p>
    {% endif %}
    {% if object.image3 %}
        <p><img src="{{ object.image3.url }}"></p>
    {% endif %}
    {% if object.image4 %}
        <p><img src="{{ object.image4.url }}"></p>
    {% endif %}
    {% if object.image5 %}
        <p><img src="{{ object.image5.url }}"></p>
    {% endif %}

<p>{{ object.category }}<p>    
<p>{{ object.created_at }}<p>
<p>{{ object.detail_text }}</p>

<!--ã„ã„ã­ãƒœã‚¿ãƒ³é–¢é€£ã®å‡¦ç†ã€ãƒ­ã‚°ã‚¤ãƒ³ã•ã‚Œã¦ã„ãªã‘ã‚Œã°ã„ã„ã­ãƒœã‚¿ãƒ³ã¯è¡¨ç¤ºã—ãªã„-->
{% if user.is_authenticated %}
    <!--ã„ã„ã­ãƒœã‚¿ãƒ³ã®è¡¨ç¤º-->
    <button id="likebutton">
    {% if user_has_liked %}
    <!--ã‚¤ã‚¤ãƒã—ã¦ã„ãªã„å ´åˆ-->
        ğŸ’—
    <!--ã‚¤ã‚¤ãƒã—ã¦ã„ã‚‹å ´åˆ-->
    {% else %}
        â™¥
    {% endif %}
    </button>

    <script>
        //ã„ã„ã­ãƒœã‚¿ãƒ³ã‚’æŒ‡å®š
        buttonElm=document.getElementById("likebutton");
        
        buttonElm.addEventListener('click', async function(event) {
            event.preventDefault();
            //ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡ä¸­ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹
            buttonElm.disabled=true;
        
            try {
                const response=await fetch("{% url 'studentapp:blogpostlike' pk=object.id %}",{
                    method:'GET',
                    headers:{
                        'X-CSRFToken':'{{ csrf_token }}'
                    }
                });
        
                if(!response.ok){
                    throw new Error('é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
        
                const data=await response.json();
        
                if(data.liked) {
                    buttonElm.textContent = "ğŸ’—";
                }else{
                    buttonElm.textContent = "â™¥";
                }
            }catch(error) {
                console.error('ã„ã„ã­ãŒæ­£å¸¸ã«ã§ãã¾ã›ã‚“ã§ã—ãŸ:', error);
                // ã‚¨ãƒ©ãƒ¼å‡¦ç†ï¼ˆä¾‹ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºï¼‰
            }finally{
                buttonElm.disabled=false;
            }
        });
    </script>



{% endif %}

{% endblock %}